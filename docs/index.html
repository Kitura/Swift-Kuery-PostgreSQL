<!DOCTYPE html>
<html lang="en">
  <head>
    <title>SwiftKueryPostgreSQL  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="SwiftKueryPostgreSQL  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          SwiftKueryPostgreSQL Docs
        </a>
         (100% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/Kitura/Swift-Kuery-PostgreSQL/">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">SwiftKueryPostgreSQL Reference</a>
      <img class="carat" src="img/carat.png" />
      SwiftKueryPostgreSQL  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PostgreSQLConnection.html">PostgreSQLConnection</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PostgreSQLResultFetcher.html">PostgreSQLResultFetcher</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/ConnectionOptions.html">ConnectionOptions</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Data.html">Data</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PostgreSQLPreparedStatement.html">PostgreSQLPreparedStatement</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <p align="center">
    <a href="http://kitura.io/">
        <img src="https://raw.githubusercontent.com/Kitura/Kitura/master/Sources/Kitura/resources/kitura-bird.svg?sanitize=true" height="100" alt="Kitura">
    </a>
</p>

<p align="center">
    <a href="https://kitura.github.io/Swift-Kuery-PostgreSQL/index.html">
    <img src="https://img.shields.io/badge/apidoc-SwiftKueryPostgreSQL-1FBCE4.svg?style=flat" alt="APIDoc">
    </a>
    <a href="https://travis-ci.org/Kitura/Swift-Kuery-PostgreSQL">
    <img src="https://travis-ci.org/Kitura/Swift-Kuery-PostgreSQL.svg?branch=master" alt="Build Status - Master">
    </a>
    <img src="https://img.shields.io/badge/os-macOS-green.svg?style=flat" alt="macOS">
    <img src="https://img.shields.io/badge/os-linux-green.svg?style=flat" alt="Linux">
    <img src="https://img.shields.io/badge/license-Apache2-blue.svg?style=flat" alt="Apache 2">
    <a href="http://swift-at-ibm-slack.mybluemix.net/">
    <img src="http://swift-at-ibm-slack.mybluemix.net/badge.svg" alt="Slack Status">
    </a>
</p>
<h1 id='swift-kuery-postgresql' class='heading'>Swift-Kuery-PostgreSQL</h1>

<p><a href="https://www.postgresql.org/">PostgreSQL</a> plugin for the <a href="https://github.com/Kitura/Swift-Kuery">Swift-Kuery</a> framework. It enables you to use Swift-Kuery to manipulate data in a PostgreSQL database.</p>
<h2 id='postgresql-client-installation' class='heading'>PostgreSQL client installation</h2>

<p>To use Swift-Kuery-PostgreSQL you must have the appropriate PostgreSQL C-language client installed.</p>
<h3 id='macos' class='heading'>macOS</h3>
<pre class="highlight plaintext"><code>$ brew install postgresql
</code></pre>
<h3 id='linux' class='heading'>Linux</h3>
<pre class="highlight plaintext"><code>$ sudo apt-get install libpq-dev
</code></pre>
<h2 id='usage' class='heading'>Usage</h2>
<h4 id='add-dependencies' class='heading'>Add dependencies</h4>

<p>Add the <code>SwiftKueryPostgreSQL</code> package to the dependencies within your applicationâ€™s <code>Package.swift</code> file. Substitute <code>&quot;x.x.x&quot;</code> with the latest <code>SwiftKueryPostgreSQL</code> <a href="https://github.com/Kitura/Swift-Kuery-PostgreSQL/releases">release</a>.</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/Kitura/Swift-Kuery-PostgreSQL.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"x.x.x"</span><span class="p">)</span>
</code></pre>

<p>Add <code>SwiftKueryPostgreSQL</code> to application&rsquo;s dependencies:</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">target</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Application"</span><span class="p">,</span> <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"SwiftKueryPostgreSQL"</span><span class="p">]),</span>
</code></pre>
<h4 id='import-package' class='heading'>Import package</h4>
<pre class="highlight swift"><code>  <span class="kd">import</span> <span class="kt">SwiftKueryPostgreSQL</span>
</code></pre>
<h2 id='using-swift-kuery-postgresql' class='heading'>Using Swift-Kuery-PostgreSQL</h2>

<p>First create an instance of <code>Swift-Kuery-PostgreSQL</code> by calling:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="kt">PostgreSQLConnection</span><span class="p">(</span><span class="nv">host</span><span class="p">:</span> <span class="n">host</span><span class="p">,</span> <span class="nv">port</span><span class="p">:</span> <span class="n">port</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">ConnectionOptions</span><span class="p">]?)</span>
</code></pre>

<p><strong>Where:</strong></p>

<ul>
<li><em>host</em> and <em>port</em> are the host and the port of PostgreSQL</li>
<li><em>ConnectionOptions</em>  an optional set of:

<ul>
<li><em>options</em> - command-line options to be sent to the server</li>
<li><em>databaseName</em> - the database name</li>
<li><em>userName</em> - the user name</li>
<li><em>password</em> - the user password</li>
<li><em>connectionTimeout</em> - maximum wait for connection in seconds. Zero or not specified means wait indefinitely.</li>
</ul></li>
</ul>

<p>For more details refer to the <a href="https://www.postgresql.org/docs/8.0/static/libpq.html#LIBPQ-CONNECT">PostgreSQL manual</a>.</p>

<p><br></p>

<p>Alternatively, call:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="kt">PostgreSQLConnection</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"Postgres://</span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">:</span><span class="se">\(</span><span class="n">password</span><span class="se">)</span><span class="s">@</span><span class="se">\(</span><span class="n">host</span><span class="se">)</span><span class="s">:</span><span class="se">\(</span><span class="n">port</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">databaseName</span><span class="se">)</span><span class="s">"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
</code></pre>

<p>To establish a connection to the database call:</p>
<pre class="highlight swift"><code><span class="n">connection</span><span class="o">.</span><span class="nf">connect</span><span class="p">()</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Connection not established, handle error</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="c1">// Connection established</span>
<span class="p">}</span>
</code></pre>

<p>You now have a connection that can be used to execute SQL queries created using Swift-Kuery.</p>
<h2 id='getting-started-with-swift-kuery-postgresql-locally' class='heading'>Getting Started with Swift-Kuery-PostgreSQL locally</h2>
<h3 id='install-postgresql-server' class='heading'>Install PostgreSQL server</h3>
<h4 id='mac' class='heading'>Mac</h4>
<pre class="highlight plaintext"><code>brew install postgresql
</code></pre>
<h4 id='ubuntu-linux' class='heading'>Ubuntu Linux</h4>
<pre class="highlight plaintext"><code>sudo apt-get install postgresql postgresql-contrib
</code></pre>

<p>Make sure you have the database running. This installation should have also installed two applications we need, namely (createdb and psql) which will be used as clients to your locally running PostgreSQL.</p>
<h3 id='create-a-database' class='heading'>Create a database</h3>

<p>Let&rsquo;s create a database called <code>school</code>:</p>
<pre class="highlight plaintext"><code>createdb school
</code></pre>
<h3 id='create-the-tables' class='heading'>Create the tables</h3>

<p>Now, let&rsquo;s create the tables we need for this example.</p>

<p>Use the interative <code>psql</code> client to open the database we created:</p>
<pre class="highlight plaintext"><code>$ psql school
psql (9.5.4)
Type "help" for help.

school=#
</code></pre>

<p>First, create the student table:</p>
<pre class="highlight sql"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">student</span> <span class="p">(</span>
 <span class="n">studentId</span> <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
 <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">name</span> <span class="o">&lt;&gt;</span> <span class="s1">''</span><span class="p">)</span>
<span class="p">);</span>
</code></pre>

<p>Next, create the grades table:</p>
<pre class="highlight sql"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">grades</span> <span class="p">(</span>
  <span class="k">key</span> <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">studentId</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">course</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">grade</span> <span class="nb">integer</span>
<span class="p">);</span>
</code></pre>
<h3 id='populate-the-tables' class='heading'>Populate the tables</h3>

<p>First the students table:</p>
<pre class="highlight sql"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Tommy Watson'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'Fred Flintstone'</span><span class="p">);</span>
</code></pre>

<p>And then the grades table:</p>
<pre class="highlight sql"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">grades</span> <span class="p">(</span><span class="n">studentId</span><span class="p">,</span> <span class="n">course</span><span class="p">,</span> <span class="n">grade</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'How to build your first computer'</span><span class="p">,</span> <span class="mi">99</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">grades</span> <span class="p">(</span><span class="n">studentId</span><span class="p">,</span> <span class="n">course</span><span class="p">,</span> <span class="n">grade</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'How to work at a rock quarry'</span><span class="p">,</span> <span class="mi">71</span><span class="p">);</span>
</code></pre>
<h3 id='use-swift-kuery' class='heading'>Use Swift-Kuery</h3>

<p>Now we are set to connect to our database from Swift and use Swift-Kuery to query the data into our Swift application.</p>
<h4 id='create-simple-swift-executable' class='heading'>Create simple Swift executable</h4>

<p>First create a directory for our project and then initialize it.</p>
<pre class="highlight plaintext"><code>$ mkdir swift-kuery-play
$ cd swift-kuery-play
$ swift package init --type executable
Creating executable package: swift-kuery-play
Creating Package.swift
Creating README.md
Creating .gitignore
Creating Sources/
Creating Sources/swift-kuery-play/main.swift
Creating Tests/
$
</code></pre>

<p>Now, add Swift-Kuery-PostgreSQL as a dependency for our project, this will automatically pull in Swift-Kuery.
Edit <code>Package.swift</code> to contain the following, substituting <code>&quot;x.x.x&quot;</code> with the latest <code>Kitura</code> and <code>Swift-Kuery-PostgreSQL</code> releases.</p>
<pre class="highlight swift"><code><span class="c1">// swift-tools-version:4.0</span>
<span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="nv">name</span><span class="p">:</span> <span class="s">"swift-kuery-play"</span><span class="p">,</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/Kitura/Kitura.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"x.x.x"</span><span class="p">),</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/Kitura/Swift-Kuery-PostgreSQL"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"x.x.x"</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">target</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"swift-kuery-play"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"Kitura"</span><span class="p">,</span> <span class="s">"SwiftKueryPostgreSQL"</span><span class="p">]),</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre>

<p>Now, edit your <code>main.swift</code> file to contain:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">SwiftKuery</span>
<span class="kd">import</span> <span class="kt">SwiftKueryPostgreSQL</span>
<span class="kd">import</span> <span class="kt">Kitura</span>

<span class="k">let</span> <span class="nv">router</span> <span class="o">=</span> <span class="kt">Router</span><span class="p">()</span>

<span class="kd">class</span> <span class="kt">Grades</span> <span class="p">:</span> <span class="kt">Table</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">tableName</span> <span class="o">=</span> <span class="s">"grades"</span>
  <span class="k">let</span> <span class="nv">key</span> <span class="o">=</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"key"</span><span class="p">)</span>
  <span class="k">let</span> <span class="nv">course</span> <span class="o">=</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"course"</span><span class="p">)</span>
  <span class="k">let</span> <span class="nv">grade</span> <span class="o">=</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"grade"</span><span class="p">)</span>
  <span class="k">let</span> <span class="nv">studentId</span> <span class="o">=</span> <span class="kt">Column</span><span class="p">(</span><span class="s">"studentId"</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">grades</span> <span class="o">=</span> <span class="kt">Grades</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="kt">PostgreSQLConnection</span><span class="p">(</span><span class="nv">host</span><span class="p">:</span> <span class="s">"localhost"</span><span class="p">,</span> <span class="nv">port</span><span class="p">:</span> <span class="mi">5432</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nf">databaseName</span><span class="p">(</span><span class="s">"school"</span><span class="p">)])</span>

<span class="kd">func</span> <span class="nf">grades</span><span class="p">(</span><span class="n">_</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>
    <span class="n">connection</span><span class="o">.</span><span class="nf">connect</span><span class="p">()</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">asError</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error connecting: Unknown Error"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error connecting: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1">// Build and execute your query here.</span>

        <span class="c1">// First build query</span>
        <span class="k">let</span> <span class="nv">query</span> <span class="o">=</span> <span class="kt">Select</span><span class="p">(</span><span class="n">grades</span><span class="o">.</span><span class="n">course</span><span class="p">,</span> <span class="n">grades</span><span class="o">.</span><span class="n">grade</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">grades</span><span class="p">)</span>

        <span class="c1">// Execute query</span>
        <span class="n">connection</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">query</span><span class="p">:</span> <span class="n">query</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">resultSet</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">asResultSet</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">asError</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error executing query: Unknown Error"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error executing query: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">var</span> <span class="nv">retString</span> <span class="o">=</span> <span class="s">""</span>
            <span class="n">resultSet</span><span class="o">.</span><span class="nf">getColumnTitles</span><span class="p">()</span> <span class="p">{</span> <span class="n">titles</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">titles</span> <span class="o">=</span> <span class="n">titles</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">guard</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error fetching column titles: Unknown Error"</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error fetching column titles: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">title</span> <span class="k">in</span> <span class="n">titles</span> <span class="p">{</span>
                    <span class="c1">//The column names of the result.</span>
                    <span class="n">retString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">title</span><span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="nv">toLength</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span> <span class="nv">withPad</span><span class="p">:</span> <span class="s">" "</span><span class="p">,</span> <span class="nv">startingAt</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="n">retString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

                <span class="n">resultSet</span><span class="o">.</span><span class="nf">forEach</span><span class="p">()</span> <span class="p">{</span> <span class="n">row</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
                    <span class="k">guard</span> <span class="k">let</span> <span class="nv">row</span> <span class="o">=</span> <span class="n">row</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// A null row means we have run out of results unless we encountered an error</span>
                        <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
                            <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error fetching row: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                        <span class="p">}</span>
                        <span class="c1">// No error so all rows are processed, make final callback passing result.</span>
                        <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="n">retString</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">value</span> <span class="k">in</span> <span class="n">row</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">value</span> <span class="p">{</span>
                            <span class="k">let</span> <span class="nv">valueString</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span>
                            <span class="n">retString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">valueString</span><span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="nv">toLength</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span> <span class="nv">withPad</span><span class="p">:</span> <span class="s">" "</span><span class="p">,</span> <span class="nv">startingAt</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="n">retString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">router</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">next</span> <span class="k">in</span>

  <span class="nf">grades</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">resp</span> <span class="k">in</span>
    <span class="n">response</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="nf">next</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">Kitura</span><span class="o">.</span><span class="nf">addHTTPServer</span><span class="p">(</span><span class="nv">onPort</span><span class="p">:</span> <span class="mi">8080</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="n">router</span><span class="p">)</span>
<span class="kt">Kitura</span><span class="o">.</span><span class="nf">run</span><span class="p">()</span>
</code></pre>

<p>Now build the program and run it:</p>
<pre class="highlight plaintext"><code>$ swift build
$ .build/debug/swift-kuery-play
</code></pre>

<p>Now open a web page to <a href="http://localhost:8080"><a href="http://localhost:8080">http://localhost:8080</a></a> and you should see:</p>
<pre class="highlight plaintext"><code>course                             grade                              
How to build your first computer   99                                 
How to work at a rock quarry       71      
</code></pre>

<p>Now we can change our query line and see different results.</p>

<p>Change the line:</p>
<pre class="highlight swift"><code>      <span class="k">let</span> <span class="nv">query</span> <span class="o">=</span> <span class="kt">Select</span><span class="p">(</span><span class="n">grades</span><span class="o">.</span><span class="n">course</span><span class="p">,</span> <span class="n">grades</span><span class="o">.</span><span class="n">grade</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">grades</span><span class="p">)</span>
</code></pre>

<p>to</p>
<pre class="highlight swift"><code>      <span class="k">let</span> <span class="nv">query</span> <span class="o">=</span> <span class="kt">Select</span><span class="p">(</span><span class="n">grades</span><span class="o">.</span><span class="n">course</span><span class="p">,</span> <span class="n">grades</span><span class="o">.</span><span class="n">grade</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">grades</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">where</span><span class="p">(</span><span class="n">grades</span><span class="o">.</span><span class="n">grade</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">)</span>
</code></pre>

<p>and we should only see grades greater than 80:</p>
<pre class="highlight plaintext"><code>course                             grade                              
How to build your first computer   99                                 
</code></pre>

<p>Another possibility is to use <code>QueryResult.asRows</code> that returns the result as an array of dictionaries where each dictionary represents a row of the result with the column title as the key.<br>
 Change your <code>grades</code> function as follows:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">grades</span><span class="p">(</span><span class="n">_</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>
    <span class="n">connection</span><span class="o">.</span><span class="nf">connect</span><span class="p">()</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">asError</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error connecting: Unknown Error"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error connecting: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">let</span> <span class="nv">query</span> <span class="o">=</span> <span class="kt">Select</span><span class="p">(</span><span class="n">grades</span><span class="o">.</span><span class="n">course</span><span class="p">,</span> <span class="n">grades</span><span class="o">.</span><span class="n">grade</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">grades</span><span class="p">)</span>
        <span class="n">connection</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="nv">query</span><span class="p">:</span> <span class="n">query</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
            <span class="n">result</span><span class="o">.</span><span class="nf">asRows</span><span class="p">()</span> <span class="p">{</span> <span class="n">rows</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">rows</span> <span class="o">=</span> <span class="n">rows</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">guard</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error getting rows: Unknown Error"</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="s">"Error getting rows: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">var</span> <span class="nv">retString</span> <span class="o">=</span> <span class="s">""</span>
                <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="n">rows</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">in</span> <span class="n">row</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">value</span> <span class="p">{</span>
                            <span class="n">retString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">title</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">value</span><span class="se">)</span><span class="s"> "</span><span class="p">)</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="n">retString</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="n">retString</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>At <a href="http://localhost:8080"><a href="http://localhost:8080">http://localhost:8080</a></a> you should see:</p>
<pre class="highlight plaintext"><code>grade: 99 course: How to build your first computer
grade: 71 course: How to work at a rock quarry  
</code></pre>
<h2 id='api-documentation' class='heading'>API Documentation</h2>

<p>For more information visit our <a href="https://kitura.github.io/Swift-Kuery-PostgreSQL/index.html">API reference</a>.</p>
<h2 id='community' class='heading'>Community</h2>

<p>We love to talk server-side Swift, and Kitura. Join our <a href="http://swift-at-ibm-slack.mybluemix.net/">Slack</a> to meet the team!</p>
<h2 id='license' class='heading'>License</h2>

<p>This library is licensed under Apache 2.0. Full license text is available in <a href="https://github.com/Kitura/SwiftKueryPostgreSQL/blob/master/LICENSE.txt">LICENSE</a></p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2021 <a class="link" href="" target="_blank" rel="external">IBM &amp; Kitura project authors</a>. All rights reserved. (Last updated: 2021-12-14)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy â™ªâ™« v0.13.7</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
